# 第四周课设报告

## 一、项目的需求

1. 项目的背景

本项目目标是实现简易微商平台，满足网购的基本功能

2. 功能需求

   1. 客户端

       1. 注册账号：
    填写填写账号，名称，密码，通过网络协议传送至服务端，服务端会调用数据库内信息对账号进行查重，保证账号的唯一性，如果没通过查重则返回客户端，通过后将账号密码名称等信息储存
       2. 登录：
    填写账号和密码，通过网络协议传送至服务端，服务端调用数据库检测账号是否存在以及密码是否正确，如果没通过则返回客户端，通过后，调取该用户的信息，传送至客户端
       3. 与客服通信：
    通过异步网通信实现客户端与服务端之间的实时通信，将信息传递到ui界面中
       4. 商品选购界面：
          1. 模糊搜索功能：
        在搜索框中输入搜索信息，传递至服务端服务端根据关键字调用出相关商品信息显示至界面
          2. 选购：
        用户可对商品页面中的商品直接购买或是加入购物车中待选，直接购买会直接向服务端发送购买请求，服务端来进行操作的合法性检测以及数据库的更改

       5. 购物车:
    实现对商品的选择的增加，删除，结算服务，实现多选化管理
       6. 秒杀服务：
    接收到服务端设置的秒杀活动，秒杀活动在特定时间开始，发送购买请求生成的订单具有短时性
       7. 订单：
    当用户发起购买请求时，会生成订单，订单有一定有效期，当经过有效期后，商品取消购买，服务端返回库存
    用户的订单分为三类，未支付订单，过期订单，已支付订单
       8. 用户信息：
    支持用户对自己信息的修改，向服务端发送更改请求
    2. 服务端
        1. 响应客户端对数据库的操作
        遵循客户端不能直接访问数据库的原则，通过服务端实现间接访问，是服务器端后台的自动操作。
        2. 与用户通信：
        通过异步网通信实现客户端与服务端之间的实时通信，将信息传递到ui界面中
        3. 商品的上架与下架：
        服务端可以上架商品的图片、信息、价格、存货，并将对应信息存储至数据库
        4. 商品的查找：
        同客户端查找商品类似，都是通过数据库模糊查询进行查找，并存在下拉框进行查找提示，达到模糊查询的效果。
        4. 发布秒杀活动:
        对限时商品的抢夺，能使服务器承受高并行的压力，对未支付订单的处理
        5. 对于未支付订单
        设置支付剩余时间，如果超时或取消支付则，加库存，这部分由服务器后端自动更新
        6. 数据分析
        允许服务商进行数据统计和处理，可以统计单个人和所有人的购买情况，可以统计单个货物和全部货物的销售情况，并实现数据可视化
3. 性能需求
   在服务端要面对多客户端所产生的高并发问题，对服务器的频繁访问会导致性能问题，主要体现在秒杀活动。
   首先面对多线程问题，我们采用线程池的思想，始终保证一定数量的线程开启，避免频繁开启关闭线程所产生的性能损耗，在客户端发送询问时向线程池索取空闲线程
   其次面对秒杀活动，对活动页面加载，在用户登录的同时直接由服务器发送，保存在客户端中，在秒杀开始的时候只需由客户端发来的操作码判断是否在活动页面，如果在则仅发送true使订购按键开启，这样可以减少瞬时服务器的处理量
   最后关于传输方面采用url编码，可以实现socket通信效率提升
## 二、相关技术

### C/S结构和B/S结构
C/S结构：客户端和服务器直接通信，适用于需要高性能和复杂交互的应用，如游戏、大型企业管理软件等。
B/S结构：通过浏览器访问服务器资源，适用于广泛分布的用户群体，如Web应用、电子商务网站等。
### 持久层
持久层在软件开发中扮演着至关重要的角色。它负责将应用数据持久化到数据库或其他存储介质中。通过持久层，开发者可以实现数据的存储、检索、更新和删除等操作，从而支持应用程序的各种业务需求。
### Web服务
Web服务是一种基于Web的分布式计算技术，允许不同平台上的应用程序相互通信。
### 并发和互斥：
并发允许多个任务同时执行，而互斥则确保同一时间只有一个任务可以访问共享资源。
应使用适当的同步机制（如读写锁等）来避免数据竞争和死锁等问题。
### 同步和异步通信
同步通信要求发送方等待接收方的响应后再继续执行，而异步通信则允许发送方在发送请求后立即继续执行其他任务。所以，在需要高性能和低延迟的场合，可以考虑使用异步通信；在需要确保数据一致性和顺序性的场合，则更适合使用同步通信。
## 三、概要设计
1. 模块划分
   模块分为三部分数据库，服务端，客户端，数据库与服务端通过持久层连接，客户端与服务端通过tcp实现通信
2. UI设计
   ![客户端登录](.\image\2.png)
   ![客户端](.\image\1.png)
3. 主要类的划分
   1. 客户端：
       1. 用户信息类
       2. 商品类
       3. 订单类
       4. 购物车商品类
    2. 服务端：
       1. 服务端类
       2. 线程池类
       3. 响应服务类
       4. 持久层类
       5. 用户信息类
       6. 商品类
       7. 订单类
       8. 购物车商品类
4. 数据库设计
   包含用户信息、商品信息、购买记录、购物车记录、聊天记录、未支付订单

    #### 用户信息

    | 名称     | 类型    | 是否为key |
    | ------- | ------- | --------- |
    | id       | int     | yes       |
    | name     | varchar | no        |
    | password | varchar | no        |
    | tel      | varchar | no        |

    #### 商品信息
    | 名称   | 类型    | 是否为key |
    | ------ | ------- | --------- |
    | id     | int     | yes       |
    |price   | int     | no        |
    | name   | varchar | no        |
    | image  | varchar | no        |
    | sales  | int     | no        |
    | stocks | int     | no        |

    #### 购买记录

    | 名称           | 类型 | 是否为key |
    | -------------- | ---- | --------- |
    | id             | int  | yes       |
    | client_id      | int  | no        |
    | time           | date | no        |

    #### 购物车记录

    | 名称      | 类型 | 是否为key |
    | --------- | ---- | --------- |
    | id        | int  | yes       |
    | client_id | int  | no        |
    | goods_id  | int  | no        |

    #### 聊天消息

    | 名称       | 类型     | 是否为key |
    | ---------- | -------- | --------- |
    | send_id    | varchar  | yes       |
    | receive_id | varchar  | no        |
    | content    | varchar  | no        |
    | time       | datetime | no        |

    #### 秒杀活动

    | 名称       | 类型     | 是否为key |
    | ---------- | -------- | --------- |
    | id        | varchar  | yes       |
    | goods_id    | varchar  | no        |
    |price   | int     | no        |
    | time       | datetime | no        |

    #### 未支付订单

    | 名称     | 类型     | 是否为key |
    | -------- | -------- | --------- |
    | id       | varchar  | yes       |
    | goods_id | varchar  | no        |
    | time     | datetime | no        |
5. 通信设计
   最开始由客户端发送操作码和相关操作信息，服务端接受信息进行解码，利用持久层对数据库进行处理，处理完成后接受持久层返回的信息，服务端将信息发送至客户端，客户端由信息进行操作。这时一个通信时序设计