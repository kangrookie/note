# 树上染色（acwing115）
---
>等效权值的思想

## 问题关键
根据题意很容易出现的问题是在一个父节点下隐藏着一个巨大的子节点，而因为父节点可能很小导致我们无法正确选择（是选择这个父节点，还是其他较大节点）
故我们要思考出一种等效法（让我们分辨出哪个更优），使得我们能做出这个决定。

### 性质
1. 首先一个贪心的策略，当我们给最大权值点的父节点染色后，下一步定是对最大权值点染色。依照这个想法我们能确定一个顺序。
2. 对于x,y,z三个点，已知x染色后立刻对y染色,那可能的顺序只有两种x,y,z或者是z,x,y

我们要比较是两种顺序的哪一种实际上就是比较$t*x+(t+1)*y+(t+2)*z$和$t*z+(t+1)*x+(t+2)*y$哪一个更小两个式子都减去$t*x+t*y+t*z$然后再都加上$2*z+x$再都除以2，即比较$z+2*\frac {x+y} 2$和$\frac {x+y} 2+2*z$这时我们发现最大值点和其父节点的等价点权值为$\frac {x+y} 2$而且此发现可以扩展
即对于任意一个点集他的等效权值为其权值平均值

### 算法
故我们可以一直查询最大权值将其与其父节点合并，合并的同时我们也确定了父节点点集染色完立刻对子节点点集染色，而点集内部的染色顺序已知
### 总结
正常想法可能是从根结点开始染色之后利用一种等效方式决定选择哪一个子节点，即确定第一个是谁，第二个是谁，第三个是谁、、、、、、但是我们会发现很难找到等效方式

我们跳出思维定式，仔细观察可以发现其实我们不一定非要知道绝对顺序（即某一个点是第几个染色的），我们只需要知道相对顺序就可以（即哪一个点紧挨着哪一个点），当我们知道一定的相对顺序后就可以还原出绝对顺序。顺着这个思路我们找相对顺序可以发现上述的性质一，但是这时我们只能找到一个相对顺序，在此之后该怎么办？？？

我们再思考怎么扩展这个性质一，当我们对一个节点，他的父节点跟他之间除了他的子节点之外，都有可能出现在这俩个节点之间，如果这个节点的权值比除了他的子节点之外的所有节点都大，那最优染色顺序一定是他和他的父节点相邻，当然权值最大的点必然满足上述条件，我们去找权值最大的点而非直接去找满足上述条件的点，是因为找最大的点更直接，既然我们都找最大权值的点了，我们不去在乎一个点是不是另一个点的祖先，对于最大权值点，无论是子节点还是不是子节点都无法插入，即我们可以都看成非子节点,取一个点比较其他点能否在其前面，这样我们得到了性质二的等效权值，如果所有点都不能排在他的前面，易知这个点是权值最大点。依据此原理把所有点都合成一个点就得到了顺序